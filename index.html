<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Members Lounge | Wedding Signature Series</title>

  <style>
    :root{
      --bg:#ffffff;
      --text:#0b0c10;
      --muted:#4b5563;
      --line:rgba(0,0,0,.10);
      --gold:#b08d2a;
      --goldSoft:rgba(176,141,42,.10);
      --shadow:0 10px 26px rgba(0,0,0,.06);
      --radius:16px;
      --ok:#0f7a3a;
      --warn:#b45309;
      --bad:#b91c1c;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    header{
      padding:22px 18px 12px;
      text-align:center;
      border-bottom:1px solid var(--line);
      background: linear-gradient(to bottom, #fff, #fff, rgba(176,141,42,.04));
    }
    .brandline{
      display:flex; align-items:center; justify-content:center; gap:12px; flex-wrap:wrap;
    }
    .logoWrap{
      display:flex; align-items:center; justify-content:center;
      padding:10px 14px;
      border:1px solid var(--line);
      border-radius:999px;
      background:#fff;
      box-shadow:0 6px 18px rgba(0,0,0,.03);
      gap:10px;
    }
    .logoImg{height:34px; width:auto; display:block;}
    .logoFallback{
      display:inline-flex; align-items:center; gap:10px;
      font-weight:800; letter-spacing:.14em; font-size:12px;
    }
    h1{margin:12px 0 6px; font-size:28px}
    .sub{color:var(--muted); font-size:14px}
    .gold{color:var(--gold)}
    main{max-width:1180px; margin:0 auto; padding:10px 18px 70px;}

    .tabs-wrap{
      position:sticky; top:0; z-index:10;
      padding:10px 0 12px;
      background: linear-gradient(to bottom, rgba(255,255,255,.98), rgba(255,255,255,.90), rgba(255,255,255,0));
      backdrop-filter: blur(6px);
    }
    .tabs{display:flex; flex-wrap:wrap; gap:10px; justify-content:center;}
    .tab{
      cursor:pointer; user-select:none;
      border:1px solid var(--line);
      background:#fff; color:var(--text);
      padding:10px 12px; border-radius:999px;
      font-size:13px; display:flex; gap:8px; align-items:center;
      transition:transform .08s ease, background .15s ease, border-color .15s ease;
      box-shadow:0 6px 18px rgba(0,0,0,.03);
      white-space:nowrap;
    }
    .tab:hover{transform: translateY(-1px)}
    .tab.active{border-color: rgba(176,141,42,.60); background:var(--goldSoft); font-weight:800;}
    .ghost{border-color: rgba(176,141,42,.60); background:var(--goldSoft); font-weight:900;}

    .page{display:none}
    .page.active{display:block}

    .grid{display:grid; grid-template-columns:1fr; gap:14px; margin-top:8px;}
    @media(min-width:920px){ .grid{grid-template-columns:1fr 1fr;} }

    .card{
      background:#fff;
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:var(--shadow);
    }
    .card h2{margin:0 0 10px; font-size:16px;}
    .hint{color:var(--muted); font-size:12px}

    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px;}
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      color:var(--text);
      outline:none;
    }
    textarea{min-height:90px; resize:vertical}
    input::placeholder, textarea::placeholder{color:rgba(75,85,99,.7)}

    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    .divider{height:1px; background:var(--line); margin:12px 0}
    .small{font-size:12px; color:var(--muted)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    .btn{
      cursor:pointer;
      border:1px solid var(--line);
      background:#fff;
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      box-shadow:0 10px 22px rgba(0,0,0,.04);
    }
    .btn:hover{border-color: rgba(176,141,42,.60)}
    .btn.primary{border-color: rgba(176,141,42,.75); background:var(--goldSoft); font-weight:900;}
    .btn.ghost{border-color: rgba(176,141,42,.75); background:var(--goldSoft); font-weight:900;}

    .table{width:100%; border-collapse:collapse; font-size:13px;}
    .table td{padding:10px 8px; border-bottom:1px solid var(--line); vertical-align:top;}
    .table td:last-child{text-align:right; font-weight:900;}
    .total{
      display:flex; justify-content:space-between; align-items:baseline; gap:12px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(176,141,42,.35);
      background: rgba(176,141,42,.08);
      margin-top:10px;
      font-weight:900;
    }

    .course{margin-top:12px; border-top:1px solid var(--line); padding-top:12px;}
    .course h3{margin:0 0 8px; font-size:14px;}
    .count{color:var(--muted); font-size:12px; margin-top:8px;}
    .warn{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(176,141,42,.35);
      background: rgba(176,141,42,.08);
      color:#47370a;
      display:none;
    }
    .statusRow{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px;
    }
    .badge{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      font-size:12px;
      font-weight:800;
    }
    .badge.ok{border-color: rgba(15,122,58,.35); background: rgba(15,122,58,.08); color: var(--ok);}
    .badge.warn{border-color: rgba(180,83,9,.35); background: rgba(180,83,9,.08); color: var(--warn);}
    .badge.bad{border-color: rgba(185,28,28,.35); background: rgba(185,28,28,.08); color: var(--bad);}

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      background:var(--goldSoft);
      border:1px solid rgba(176,141,42,.35);
      color:var(--text);
      font-size:12px;
      margin:6px 6px 0 0;
    }

    .kpi{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;}
    @media(min-width:920px){ .kpi{grid-template-columns:1fr 1fr 1fr 1fr;} }
    .kpi .box{border:1px solid var(--line); background:#fff; border-radius:14px; padding:12px;}
    .kpi .box .label{font-size:11px; color:var(--muted)}
    .kpi .box .value{font-size:18px; font-weight:900; margin-top:4px}

    footer{
      text-align:center;
      color:var(--muted);
      font-size:12px;
      padding:18px 0 26px;
      border-top:1px solid var(--line);
      background:#fff;
    }

    @media print{
      .tabs-wrap, .actions, .btn { display:none !important; }
      .card{ box-shadow:none; }
    }
  </style>
</head>

<body>
  <header>
    <div class="brandline">
      <div class="logoWrap">
        <img class="logoImg" id="logoImg" src="logo.png" alt="The Members Lounge Logo"
             onerror="this.style.display='none'; document.getElementById('logoFallback').style.display='inline-flex';">
        <span class="logoFallback" id="logoFallback" style="display:none;">‚ú® <span>THE MEMBERS LOUNGE</span></span>
      </div>
    </div>

    <h1><span class="gold">Wedding Signature Series</span></h1>
    <div class="sub">Reggio Calabria Club, Parkville</div>
    <div class="small" style="margin-top:6px;">
      Tap the tabs or use üëª Next to move through each step.
    </div>
  </header>

  <div class="tabs-wrap">
    <div class="tabs" role="tablist" aria-label="Wedding signature tabs">
      <div class="tab active" data-page="quote" role="tab" aria-selected="true">üßæ Quote</div>
      <div class="tab" data-page="couple" role="tab" aria-selected="false">üíç Couple</div>
      <div class="tab" data-page="food" role="tab" aria-selected="false">üçΩÔ∏è Food</div>
      <div class="tab" data-page="drinks" role="tab" aria-selected="false">üçæ Drinks</div>
      <div class="tab" data-page="summary" role="tab" aria-selected="false">‚úÖ Summary</div>
      <div class="tab ghost" id="ghostNext" title="Tap to move to next tab">üëª Next</div>
    </div>
  </div>

  <main>
    <!-- QUOTE -->
    <section class="page active" id="page-quote">
      <div class="grid">
        <div class="card">
          <h2>Indicative Quote (Live)</h2>
          <div class="hint">Your selections update the estimate instantly.</div>

          <div class="divider"></div>

          <div class="row">
            <div>
              <label for="adults">Adults</label>
              <input id="adults" type="number" min="0" step="1" value="120">
            </div>
            <div>
              <label for="children">Children (Under 12)</label>
              <input id="children" type="number" min="0" step="1" value="20">
            </div>
          </div>

          <label for="roomHire">Room Hire (AUD)</label>
          <input id="roomHire" type="number" min="0" step="50" value="0">

          <div class="row">
            <div>
              <label for="dryHire">Dry Hire (AUD)</label>
              <input id="dryHire" type="number" min="0" step="50" value="0">
            </div>
            <div>
              <label for="security">Security (AUD)</label>
              <input id="security" type="number" min="0" step="50" value="0">
            </div>
          </div>

          <div class="divider"></div>

          <table class="table" aria-label="Quote breakdown">
            <tbody>
              <tr><td>Room hire</td><td id="qRoom">$0.00</td></tr>
              <tr><td>Food</td><td id="qFood">$0.00</td></tr>
              <tr><td>Drinks</td><td id="qDrinks">$0.00</td></tr>
              <tr><td>Dry hire</td><td id="qDry">$0.00</td></tr>
              <tr><td>Security</td><td id="qSec">$0.00</td></tr>
            </tbody>
          </table>

          <div class="total">
            <div>Total Estimated Cost</div>
            <div id="qTotal" class="mono">$0.00</div>
          </div>

          <div class="actions">
            <button class="btn" id="saveDraft">üíæ Save</button>
            <button class="btn" id="loadDraft">üì• Load</button>
            <button class="btn" id="resetAll">üßπ Reset</button>
            <button class="btn" id="printQuote">üñ®Ô∏è Print</button>
            <button class="btn primary" id="nextQ">üëª Next</button>
          </div>
        </div>

        <div class="card">
          <h2>Snapshot</h2>

          <div class="statusRow">
            <span class="badge" id="menuBadge">Menu: In progress</span>
            <span class="badge" id="drinksBadge">Drinks: In progress</span>
          </div>

          <div class="kpi">
            <div class="box"><div class="label">Adults</div><div class="value" id="kpiAdults">120</div></div>
            <div class="box"><div class="label">Children</div><div class="value" id="kpiChildren">20</div></div>
            <div class="box"><div class="label">Food subtotal</div><div class="value mono" id="kpiFood">$0.00</div></div>
            <div class="box"><div class="label">Per adult (weighted)</div><div class="value mono" id="kpiPerAdult">$0.00</div></div>
          </div>

          <div class="divider"></div>
          <div class="small">
            Your quote becomes ‚Äúcomplete‚Äù when the Food selections meet the exact pick rules.
          </div>
        </div>
      </div>
    </section>

    <!-- COUPLE -->
    <section class="page" id="page-couple">
      <div class="grid">
        <div class="card">
          <h2>Couple Details</h2>

          <label for="coupleName">Couple Name</label>
          <input id="coupleName" placeholder="e.g., Laura & Daniel">

          <div class="row">
            <div>
              <label for="weddingDate">Preferred Date</label>
              <input id="weddingDate" type="date">
            </div>
            <div>
              <label for="venueSpace">Venue Space</label>
              <select id="venueSpace">
                <option>Sala Reggio Ballroom</option>
                <option>Members Lounge Restaurant</option>
                <option>FIOR</option>
                <option>ALORA</option>
                <option>Bistroteca</option>
              </select>
            </div>
          </div>

          <label for="email">Email</label>
          <input id="email" type="email" placeholder="name@email.com">

          <label for="phone">Phone</label>
          <input id="phone" type="tel" placeholder="04xx xxx xxx">

          <label for="notes">Notes / Requirements</label>
          <textarea id="notes" placeholder="Dietary notes, timing, styling, music, special requests‚Ä¶"></textarea>

          <div class="actions">
            <button class="btn ghost" id="backC">‚¨ÖÔ∏è Back</button>
            <button class="btn primary" id="nextC">üëª Next</button>
          </div>
        </div>

        <div class="card">
          <h2>How it works</h2>
          <div class="small">
            1) Choose your Food selections (exact rules)<br>
            2) Choose Drinks<br>
            3) Summary shows a clean breakdown & total estimate.
          </div>
        </div>
      </div>
    </section>

    <!-- FOOD -->
    <section class="page" id="page-food">
      <div class="card">
        <h2>Food Selections</h2>
        <div class="hint">Selections are guided so your menu stays clean and complete.</div>

        <div class="statusRow">
          <span class="badge" id="foodCompleteBadge">Menu: In progress</span>
          <span class="badge" id="foodRuleBadge">Selections: Not complete</span>
        </div>

        <div class="divider"></div>

        <!-- Pricing (still editable, but phrased elegantly) -->
        <div class="grid">
          <div class="card">
            <h2>Menu Investment (Per Adult)</h2>
            <div class="hint">These values shape your estimate. Adjust if required.</div>

            <div class="row">
              <div>
                <label for="pCanapes">Canap√©s</label>
                <input id="pCanapes" type="number" min="0" step="0.5" value="12">
              </div>
              <div>
                <label for="pAntipasto">Grande Antipasto</label>
                <input id="pAntipasto" type="number" min="0" step="0.5" value="28">
              </div>
            </div>

            <div class="row">
              <div>
                <label for="pPasta">Entr√©e / Pasta</label>
                <input id="pPasta" type="number" min="0" step="0.5" value="15">
              </div>
              <div>
                <label for="pMains">Mains</label>
                <input id="pMains" type="number" min="0" step="0.5" value="34">
              </div>
            </div>

            <div class="row">
              <div>
                <label for="pDessert">Dessert</label>
                <input id="pDessert" type="number" min="0" step="0.5" value="10">
              </div>
              <div>
                <label for="pSupper">Supper (optional)</label>
                <input id="pSupper" type="number" min="0" step="0.5" value="0">
              </div>
            </div>

            <div class="divider"></div>

            <label style="margin-top:0;">
              <input id="enableSupperPricing" type="checkbox">
              Include supper in the estimate (only when selected)
            </label>
            <div class="small">If unchecked, supper remains informational only.</div>

            <div style="display:none">
              <!-- kept internally for your original maths; hidden from users -->
              <input id="adultFactor" type="number" value="1.00">
              <input id="childFactor" type="number" value="0.30">
            </div>
          </div>

          <div class="card">
            <h2>Selection Guide</h2>
            <ul class="small">
              <li><b>Canap√©s:</b> included</li>
              <li><b>Grande Antipasto:</b> included</li>
              <li><b>Entr√©e / Pasta:</b> included</li>
              <li><b>Mains:</b> exactly 2</li>
              <li><b>Dessert:</b> exactly 1</li>
              <li><b>Supper:</b> included</li>
            </ul>

            <div class="divider"></div>

            <label>
              <input id="vegMain" type="checkbox">
              Add Vegetarian Main option
            </label>

            <label style="margin-top:12px;">
              <input id="fruitPlatter" type="checkbox">
              Add Fruit Platter (optional)
            </label>

            <div class="row">
              <div>
                <label for="tables">Estimated Tables</label>
                <input id="tables" type="number" min="0" step="1" value="10">
              </div>
              <div>
                <label for="fruitPerTable">Fruit platter per table (AUD)</label>
                <input id="fruitPerTable" type="number" min="0" step="1" value="35">
              </div>
            </div>

            <div class="actions">
              <button class="btn ghost" id="backF1">‚¨ÖÔ∏è Back</button>
              <button class="btn primary" id="nextF1">üëª Next</button>
            </div>
          </div>
        </div>

        <!-- Selections -->
        <div class="course" data-course="Mains" data-limit="2" data-exact="2">
          <h3>Mains (choose exactly 2)</h3>
          <div class="row" id="list-Mains"></div>
          <div class="count" id="count-Mains">0/2 selected</div>
          <div class="warn" id="warn-Mains">Please select exactly 2 mains.</div>
        </div>

        <div class="course" data-course="Dessert" data-limit="1" data-exact="1">
          <h3>Dessert (choose exactly 1)</h3>
          <div class="row" id="list-Dessert"></div>
          <div class="count" id="count-Dessert">0/1 selected</div>
          <div class="warn" id="warn-Dessert">Please select exactly 1 dessert option.</div>
        </div>

        <div class="course" data-course="Supper" data-limit="6" data-exact="0">
          <h3>Supper / Late Night (optional ‚Äî up to 6)</h3>
          <div class="row" id="list-Supper"></div>
          <div class="count" id="count-Supper">0/6 selected</div>
          <div class="warn" id="warn-Supper">Maximum 6 supper selections.</div>
        </div>

        <div class="actions">
          <button class="btn ghost" id="backF2">‚¨ÖÔ∏è Back</button>
          <button class="btn primary" id="nextF2">üëª Next</button>
        </div>
      </div>
    </section>

    <!-- DRINKS -->
    <section class="page" id="page-drinks">
      <div class="grid">
        <div class="card">
          <h2>Drinks</h2>
          <div class="hint">Select your preferred option. Quote updates live.</div>

          <label for="drinkMode">Drinks Option</label>
          <select id="drinkMode">
            <option value="bar">Bar Prices (pay as you go)</option>
            <option value="pkg20">$20 per Adult Package (4 hrs)</option>
            <option value="custom">Custom per Adult (set price)</option>
          </select>

          <div class="row" id="customDrinkRow" style="display:none">
            <div>
              <label for="customDrinkPrice">Custom drink price per adult (AUD)</label>
              <input id="customDrinkPrice" type="number" min="0" step="1" value="0">
            </div>
            <div>
              <label for="customDrinkNote">Custom notes</label>
              <input id="customDrinkNote" placeholder="e.g., Premium spirits included‚Ä¶">
            </div>
          </div>

          <div class="divider"></div>
          <div class="small" id="drinkInfo"></div>

          <div class="actions">
            <button class="btn ghost" id="backD">‚¨ÖÔ∏è Back</button>
            <button class="btn primary" id="nextD">üëª Next</button>
          </div>
        </div>

        <div class="card">
          <h2>Status</h2>
          <div class="statusRow">
            <span class="badge" id="drinksCompleteBadge">Drinks: In progress</span>
          </div>
          <div class="divider"></div>
          <div class="small">
            Bar prices will show $0 for drinks (indicative). Packages add into the estimate.
          </div>
        </div>
      </div>
    </section>

    <!-- SUMMARY -->
    <section class="page" id="page-summary">
      <div class="grid">
        <div class="card">
          <h2>Summary</h2>
          <div id="finalSummary" class="small">Complete the steps to see your summary.</div>

          <div class="divider"></div>
          <div class="actions">
            <button class="btn" id="copySummary">üìã Copy</button>
            <button class="btn" id="printSummary">üñ®Ô∏è Print</button>
          </div>

          <div class="actions" style="margin-top:14px">
            <button class="btn ghost" id="backS">‚¨ÖÔ∏è Back</button>
            <button class="btn primary" id="toQuote">üëª Back to Quote</button>
          </div>
        </div>

        <div class="card">
          <h2>Selected Items</h2>
          <div id="chips"></div>
          <div class="divider"></div>
          <div class="small">
            Add <b>logo.png</b> next to <b>index.html</b> in your repo to display the Members Lounge logo.
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    Members Lounge | Reggio Calabria Club, Parkville
  </footer>

<script>
  const MENU = {
    "Canap√©s": [
      "Arancini",
      "Meatballs",
      "Prawn Wontons",
    ],
    "Antipasto": [
      "Sausages",
      "Bocconcini & Ricotta",
      "Salumi",
      "Eggplant parmigiana",
      "Grilled capsicum, olives & artichokes",
      "Tomato bruschetta",
      "Calamari fritti"
    ],
    "Pasta": [
      "Elicoidali al Rag√∫ (four meat sauce)",
      "Gnocchi Pesto (vegetarian)",
    ],
    "Mains": [
      "Pollo Provinciale (roasted chicken breast + Chimmichurri base)",
      "Cotoletta de Pesce (barramundi + southern Italian herb crumbed coating)",
      "Lamb Shank (white wine & tomato sauce)"
    ],
    "Dessert": [
      "Roaming assorted desserts (mini cannoli + mini cheesecakes + lemon tarts)",
      "Continental selection (select two individual desserts)",
      "Gelato dessert classic"
    ],
    "Supper": [
      "Pizza",
    ]
  };

  const RULES = {
    "Canap√©s": { exact: 3, max: 3 },
    "Pasta":   { exact: 2, max: 2 },
    "Mains":   { exact: 2, max: 2 },
    "Dessert": { exact: 1, max: 1 },
    "Supper":  { exact: 1, max: 1 }
  };

  const TAB_ORDER = ["quote","couple","food","drinks","summary"];
  function setActivePage(page){
    document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
    const target = document.getElementById("page-" + page);
    if(target) target.classList.add("active");

    document.querySelectorAll(".tab[data-page]").forEach(t => {
      const active = t.dataset.page === page;
      t.classList.toggle("active", active);
      t.setAttribute("aria-selected", active ? "true" : "false");
    });

    window.scrollTo({ top: 0, behavior: "smooth" });
    renderAll();
  }
  function nextPage(){
    const current = document.querySelector(".tab[data-page].active")?.dataset.page || "quote";
    const idx = TAB_ORDER.indexOf(current);
    setActivePage(TAB_ORDER[(idx + 1) % TAB_ORDER.length]);
  }
  function prevPage(){
    const current = document.querySelector(".tab[data-page].active")?.dataset.page || "quote";
    const idx = TAB_ORDER.indexOf(current);
    setActivePage(TAB_ORDER[(idx - 1 + TAB_ORDER.length) % TAB_ORDER.length]);
  }

  document.querySelectorAll(".tab[data-page]").forEach(tab => {
    tab.addEventListener("click", () => setActivePage(tab.dataset.page));
  });
  document.getElementById("ghostNext").addEventListener("click", nextPage);

  document.getElementById("nextQ").addEventListener("click", nextPage);
  document.getElementById("backC").addEventListener("click", prevPage);
  document.getElementById("nextC").addEventListener("click", nextPage);
  document.getElementById("backF1").addEventListener("click", prevPage);
  document.getElementById("nextF1").addEventListener("click", nextPage);
  document.getElementById("backF2").addEventListener("click", prevPage);
  document.getElementById("nextF2").addEventListener("click", nextPage);
  document.getElementById("backD").addEventListener("click", prevPage);
  document.getElementById("nextD").addEventListener("click", nextPage);
  document.getElementById("backS").addEventListener("click", prevPage);
  document.getElementById("toQuote").addEventListener("click", () => setActivePage("quote"));

  window.addEventListener("keydown", (e) => {
    if(e.key === "ArrowRight") nextPage();
    if(e.key === "ArrowLeft") prevPage();
  });

  const $ = (id) => document.getElementById(id);

  const adultsEl   = $("adults");
  const childrenEl = $("children");
  const roomHireEl = $("roomHire");
  const dryHireEl  = $("dryHire");
  const securityEl = $("security");

  const adultFactorEl = $("adultFactor");   // hidden
  const childFactorEl = $("childFactor");   // hidden

  const pCanapesEl  = $("pCanapes");
  const pAntipastoEl= $("pAntipasto");
  const pPastaEl    = $("pPasta");
  const pMainsEl    = $("pMains");
  const pDessertEl  = $("pDessert");
  const pSupperEl   = $("pSupper");
  const enableSupperPricingEl = $("enableSupperPricing");

  const antipastoFixedEl = $("antipastoFixed");
  const vegMainEl = $("vegMain");
  const fruitPlatterEl = $("fruitPlatter");
  const tablesEl = $("tables");
  const fruitPerTableEl = $("fruitPerTable");

  const drinkModeEl = $("drinkMode");
  const customDrinkRow = $("customDrinkRow");
  const customDrinkPriceEl = $("customDrinkPrice");
  const customDrinkNoteEl = $("customDrinkNote");
  const drinkInfoEl = $("drinkInfo");

  const coupleNameEl = $("coupleName");
  const weddingDateEl = $("weddingDate");
  const venueSpaceEl = $("venueSpace");
  const emailEl = $("email");
  const phoneEl = $("phone");
  const notesEl = $("notes");

  const qRoomEl   = $("qRoom");
  const qFoodEl   = $("qFood");
  const qDrinksEl = $("qDrinks");
  const qDryEl    = $("qDry");
  const qSecEl    = $("qSec");
  const qTotalEl  = $("qTotal");

  const kpiAdultsEl  = $("kpiAdults");
  const kpiChildrenEl= $("kpiChildren");
  const kpiFoodEl    = $("kpiFood");
  const kpiPerAdultEl= $("kpiPerAdult");

  const finalSummaryEl = $("finalSummary");
  const chipsEl = $("chips");

  const menuBadgeEl = $("menuBadge");
  const drinksBadgeEl = $("drinksBadge");
  const foodCompleteBadgeEl = $("foodCompleteBadge");
  const foodRuleBadgeEl = $("foodRuleBadge");
  const drinksCompleteBadgeEl = $("drinksCompleteBadge");

  const STORAGE_KEY = "memberslounge_wedding_signature_series_v2";

  function aud(n){
    const x = Number(n || 0);
    return x.toLocaleString("en-AU", { style:"currency", currency:"AUD" });
  }
  function escapeHtml(str){
    return String(str || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
  function sum(arr){ return arr.reduce((a,b)=>a+Number(b||0),0); }

  function setBadge(el, state, text){
    el.classList.remove("ok","warn","bad");
    if(state) el.classList.add(state);
    el.textContent = text;
  }

  function addCheckboxList(course, listId){
    const wrap = document.getElementById(listId);
    wrap.innerHTML = "";
    MENU[course].forEach(item => {
      const safe = (course + "-" + item).replaceAll(" ","_").replaceAll("/","-");
      const div = document.createElement("div");
      div.innerHTML = `
        <label>
          <input type="checkbox" data-course="${course}" value="${escapeHtml(item)}" id="cb-${safe}">
          ${escapeHtml(item)}
        </label>
      `;
      wrap.appendChild(div);
    });
  }

  function renderFixedAntipasto(){
    antipastoFixedEl.innerHTML = `
      <div class="small">
        Included: ${MENU["Antipasto"].map(escapeHtml).join(", ")}.
      </div>
    `;
  }

  function getSelections(){
    const out = { Canap√©s:[], Pasta:[], Mains:[], Dessert:[], Supper:[] };
    document.querySelectorAll('input[type="checkbox"][data-course]:checked').forEach(cb => {
      const c = cb.dataset.course;
      if(out[c]) out[c].push(cb.value);
    });
    return out;
  }

  function enforceLimit(course){
    const rule = RULES[course];
    if(!rule) return;

    const checked = document.querySelectorAll(`input[type="checkbox"][data-course="${course}"]:checked`);
    if(checked.length > rule.max){
      checked[checked.length - 1].checked = false;
    }
    const checked2 = document.querySelectorAll(`input[type="checkbox"][data-course="${course}"]:checked`);
    const countEl = document.getElementById(`count-${course}`);
    const warnEl  = document.getElementById(`warn-${course}`);

    if(countEl) countEl.textContent = `${checked2.length}/${rule.max} selected`;

    if(rule.exact > 0){
      warnEl.style.display = (checked2.length === rule.exact) ? "none" : "block";
    }else{
      warnEl.style.display = (checked2.length >= rule.max) ? "block" : "none";
    }
  }

  function menuIsComplete(){
    const sel = getSelections();
    let ok = true;
    ["Canap√©s","Pasta","Mains","Dessert"].forEach(course => {
      const rule = RULES[course];
      if(sel[course].length !== rule.exact) ok = false;
    });
    return ok;
  }

  function coursePricesAdult(){
    return {
      Canap√©s:  Number(pCanapesEl.value || 0),
      Antipasto:Number(pAntipastoEl.value || 0),
      Pasta:    Number(pPastaEl.value || 0),
      Mains:    Number(pMainsEl.value || 0),
      Dessert:  Number(pDessertEl.value || 0),
      Supper:   Number(pSupperEl.value || 0)
    };
  }

  function foodSubtotal(){
    const adults = Number(adultsEl.value || 0);
    const kids   = Number(childrenEl.value || 0);

    const adultFactor = Number(adultFactorEl.value || 1);
    const childFactor = Number(childFactorEl.value || 0.30);

    const sel = getSelections();
    const prices = coursePricesAdult();

    let perAdult = 0;

    if(sel.Canap√©s.length === RULES["Canap√©s"].exact) perAdult += prices.Canap√©s;
    perAdult += prices.Antipasto;
    if(sel.Pasta.length === RULES["Pasta"].exact) perAdult += prices.Pasta;
    if(sel.Mains.length === RULES["Mains"].exact) perAdult += prices.Mains;
    if(sel.Dessert.length === RULES["Dessert"].exact) perAdult += prices.Dessert;

    if(enableSupperPricingEl.checked && sel.Supper.length > 0) perAdult += prices.Supper;

    let addOns = 0;
    if(fruitPlatterEl.checked){
      addOns += Number(tablesEl.value || 0) * Number(fruitPerTableEl.value || 0);
    }

    const adultFood = adults * (perAdult * adultFactor);
    const childFood = kids   * (perAdult * adultFactor * childFactor);

    return { perAdult, adultFood, childFood, addOns, total: adultFood + childFood + addOns };
  }

  function drinksSubtotal(){
    const adults = Number(adultsEl.value || 0);
    const mode = drinkModeEl.value;

    if(mode === "bar")   return { total: 0, note: "Bar prices (pay as you go)." };
    if(mode === "pkg20") return { total: adults * 20, note: "$20 per adult (4 hrs)." };
    if(mode === "custom"){
      return {
        total: adults * Number(customDrinkPriceEl.value || 0),
        note: (customDrinkNoteEl.value || "Custom drinks package.")
      };
    }
    return { total: 0, note: "" };
  }

  function fixedSubtotal(){
    return sum([roomHireEl.value, dryHireEl.value, securityEl.value]);
  }

  function quoteTotals(){
    const food = foodSubtotal();
    const drinks = drinksSubtotal();
    const fixed = fixedSubtotal();
    return {
      adults: Number(adultsEl.value || 0),
      children: Number(childrenEl.value || 0),
      food, drinks, fixed,
      total: food.total + drinks.total + fixed
    };
  }

  function renderDrinkInfo(){
    const mode = drinkModeEl.value;
    customDrinkRow.style.display = (mode === "custom") ? "grid" : "none";

    if(mode === "bar"){
      drinkInfoEl.textContent = "Bar prices selected (pay as you go).";
      setBadge(drinksCompleteBadgeEl, "ok", "Drinks: Bar prices");
      setBadge(drinksBadgeEl, "ok", "Drinks: Bar prices");
    } else if(mode === "pkg20"){
      drinkInfoEl.textContent = "$20 per adult drink package (4 hours).";
      setBadge(drinksCompleteBadgeEl, "ok", "Drinks: $20/adult");
      setBadge(drinksBadgeEl, "ok", "Drinks: $20/adult");
    } else {
      drinkInfoEl.textContent = "Custom drink package per adult.";
      const price = Number(customDrinkPriceEl.value || 0);
      if(price > 0){
        setBadge(drinksCompleteBadgeEl, "ok", "Drinks: Custom set");
        setBadge(drinksBadgeEl, "ok", "Drinks: Custom set");
      }else{
        setBadge(drinksCompleteBadgeEl, "warn", "Drinks: Set price");
        setBadge(drinksBadgeEl, "warn", "Drinks: Set price");
      }
    }
  }

  function renderMenuStatus(){
    const sel = getSelections();
    let incomplete = [];
    ["Canap√©s","Pasta","Mains","Dessert"].forEach(c => {
      const need = RULES[c].exact;
      const got = sel[c].length;
      if(got !== need) incomplete.push(`${c} ${got}/${need}`);
    });

    if(incomplete.length === 0){
      setBadge(foodCompleteBadgeEl, "ok", "Menu: Complete");
      setBadge(foodRuleBadgeEl, "ok", "Selections: Complete");
      setBadge(menuBadgeEl, "ok", "Menu: Complete");
    }else{
      setBadge(foodCompleteBadgeEl, "warn", "Menu: In progress");
      setBadge(foodRuleBadgeEl, "warn", "Selections: Not complete");
      setBadge(menuBadgeEl, "warn", "Menu: In progress");
    }
  }

  function renderQuote(){
    const q = quoteTotals();

    qRoomEl.textContent   = aud(roomHireEl.value);
    qDryEl.textContent    = aud(dryHireEl.value);
    qSecEl.textContent    = aud(securityEl.value);

    qFoodEl.textContent   = aud(q.food.total);
    qDrinksEl.textContent = aud(q.drinks.total);
    qTotalEl.textContent  = aud(q.total);

    kpiAdultsEl.textContent   = q.adults;
    kpiChildrenEl.textContent = q.children;
    kpiFoodEl.textContent     = aud(q.food.total);

    const perAdultWeighted = q.adults > 0 ? (q.total / q.adults) : 0;
    kpiPerAdultEl.textContent = aud(perAdultWeighted);
  }

  function renderSummary(){
    const q = quoteTotals();
    const sel = getSelections();

    const chips = [];
    Object.entries(sel).forEach(([course, items]) => {
      items.forEach(item => chips.push(`<span class="pill">${escapeHtml(course)}: ${escapeHtml(item)}</span>`));
    });
    if(vegMainEl.checked) chips.push(`<span class="pill">Mains: Vegetarian option</span>`);
    if(fruitPlatterEl.checked) chips.push(`<span class="pill">Fruit platter add-on</span>`);
    chipsEl.innerHTML = chips.join(" ");

    const lines = [];
    lines.push(`<b>Couple:</b> ${escapeHtml(coupleNameEl.value || "‚Äî")}`);
    lines.push(`<b>Date:</b> ${escapeHtml(weddingDateEl.value || "‚Äî")}`);
    lines.push(`<b>Venue:</b> ${escapeHtml(venueSpaceEl.value || "‚Äî")}`);
    lines.push(`<b>Email:</b> ${escapeHtml(emailEl.value || "‚Äî")}`);
    lines.push(`<b>Phone:</b> ${escapeHtml(phoneEl.value || "‚Äî")}`);
    if((notesEl.value || "").trim()){
      lines.push(`<b>Notes:</b> ${escapeHtml(notesEl.value.trim())}`);
    }

    lines.push(`<hr style="border:none;border-top:1px solid rgba(0,0,0,.10);margin:12px 0">`);

    const perAdultWeighted = q.adults > 0 ? (q.total / q.adults) : 0;
    lines.push(`<b>Guests:</b> Adults ${q.adults}, Children ${q.children}`);
    lines.push(`<b>Room hire:</b> ${aud(roomHireEl.value)}`);
    lines.push(`<b>Dry hire:</b> ${aud(dryHireEl.value)}`);
    lines.push(`<b>Security:</b> ${aud(securityEl.value)}`);
    lines.push(`<b>Food total:</b> ${aud(q.food.total)}`);
    lines.push(`<b>Drinks total:</b> ${aud(q.drinks.total)} <span class="small">(${escapeHtml(q.drinks.note)})</span>`);
    lines.push(`<div class="total"><div>Total Estimated Cost</div><div class="mono">${aud(q.total)}</div></div>`);
    lines.push(`<div class="small" style="margin-top:8px;"><b>Per adult (weighted):</b> ${aud(perAdultWeighted)}</div>`);

    lines.push(`<hr style="border:none;border-top:1px solid rgba(0,0,0,.10);margin:12px 0">`);

    lines.push(`<b>Menu status:</b> ${menuIsComplete() ? "‚úÖ Complete" : "‚ö†Ô∏è Please finish required picks"}<br>`);
    lines.push(`<b>Canap√©s:</b> ${sel.Canap√©s.length ? sel.Canap√©s.map(escapeHtml).join(", ") : "‚Äî"}`);
    lines.push(`<b>Grande Antipasto:</b> Included`);
    lines.push(`<b>Pasta:</b> ${sel.Pasta.length ? sel.Pasta.map(escapeHtml).join(", ") : "‚Äî"}`);
    lines.push(`<b>Mains:</b> ${sel.Mains.length ? sel.Mains.map(escapeHtml).join(", ") : "‚Äî"}${vegMainEl.checked ? " + Vegetarian option" : ""}`);
    lines.push(`<b>Dessert:</b> ${sel.Dessert.length ? sel.Dessert.map(escapeHtml).join(", ") : "‚Äî"}${fruitPlatterEl.checked ? " + Fruit platter add-on" : ""}`);
    lines.push(`<b>Supper:</b> ${sel.Supper.length ? sel.Supper.map(escapeHtml).join(", ") : "‚Äî"}`);

    finalSummaryEl.innerHTML = lines.join("<br>");
  }

  function renderAll(){
    renderDrinkInfo();
    renderMenuStatus();
    renderQuote();
    renderSummary();
  }

  function getState(){
    const selections = { Canap√©s:[], Pasta:[], Mains:[], Dessert:[], Supper:[] };
    document.querySelectorAll('input[type="checkbox"][data-course]:checked').forEach(cb => {
      const c = cb.dataset.course;
      if(selections[c]) selections[c].push(cb.value);
    });

    return {
      adults: adultsEl.value, children: childrenEl.value,
      roomHire: roomHireEl.value, dryHire: dryHireEl.value, security: securityEl.value,
      prices: {
        pCanapes: pCanapesEl.value, pAntipasto: pAntipastoEl.value, pPasta: pPastaEl.value,
        pMains: pMainsEl.value, pDessert: pDessertEl.value, pSupper: pSupperEl.value,
        enableSupperPricing: enableSupperPricingEl.checked
      },
      couple: {
        coupleName: coupleNameEl.value, weddingDate: weddingDateEl.value, venueSpace: venueSpaceEl.value,
        email: emailEl.value, phone: phoneEl.value, notes: notesEl.value
      },
      drinks: {
        mode: drinkModeEl.value, customPrice: customDrinkPriceEl.value, customNote: customDrinkNoteEl.value
      },
      menu: {
        selections, vegMain: vegMainEl.checked,
        fruitPlatter: fruitPlatterEl.checked, tables: tablesEl.value, fruitPerTable: fruitPerTableEl.value
      }
    };
  }

  function setState(s){
    adultsEl.value   = s.adults ?? 120;
    childrenEl.value = s.children ?? 20;
    roomHireEl.value = s.roomHire ?? 0;
    dryHireEl.value  = s.dryHire ?? 0;
    securityEl.value = s.security ?? 0;

    if(s.prices){
      pCanapesEl.value = s.prices.pCanapes ?? 12;
      pAntipastoEl.value = s.prices.pAntipasto ?? 28;
      pPastaEl.value = s.prices.pPasta ?? 15;
      pMainsEl.value = s.prices.pMains ?? 34;
      pDessertEl.value = s.prices.pDessert ?? 10;
      pSupperEl.value = s.prices.pSupper ?? 0;
      enableSupperPricingEl.checked = !!s.prices.enableSupperPricing;
    }

    if(s.couple){
      coupleNameEl.value = s.couple.coupleName ?? "";
      weddingDateEl.value = s.couple.weddingDate ?? "";
      venueSpaceEl.value = s.couple.venueSpace ?? "Sala Reggio Ballroom";
      emailEl.value = s.couple.email ?? "";
      phoneEl.value = s.couple.phone ?? "";
      notesEl.value = s.couple.notes ?? "";
    }

    if(s.drinks){
      drinkModeEl.value = s.drinks.mode ?? "bar";
      customDrinkPriceEl.value = s.drinks.customPrice ?? 0;
      customDrinkNoteEl.value = s.drinks.customNote ?? "";
    }

    vegMainEl.checked = !!(s.menu && s.menu.vegMain);
    fruitPlatterEl.checked = !!(s.menu && s.menu.fruitPlatter);
    tablesEl.value = (s.menu && s.menu.tables) ?? 10;
    fruitPerTableEl.value = (s.menu && s.menu.fruitPerTable) ?? 35;

    document.querySelectorAll('input[type="checkbox"][data-course]').forEach(cb => cb.checked = false);

    if(s.menu && s.menu.selections){
      Object.entries(s.menu.selections).forEach(([course, items]) => {
        (items || []).forEach(item => {
          const cb = [...document.querySelectorAll(`input[type="checkbox"][data-course="${course}"]`)]
            .find(x => x.value === item);
          if(cb) cb.checked = true;
        });
        enforceLimit(course);
      });
    }

    renderAll();
  }

  document.getElementById("saveDraft").addEventListener("click", () => {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(getState()));
    alert("Saved ‚úÖ");
  });

  document.getElementById("loadDraft").addEventListener("click", () => {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return alert("No saved draft found.");
    try{
      setState(JSON.parse(raw));
      alert("Loaded ‚úÖ");
    }catch(e){
      alert("Could not load draft.");
    }
  });

  document.getElementById("resetAll").addEventListener("click", () => {
    if(!confirm("Reset everything?")) return;
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  });

  document.getElementById("printQuote").addEventListener("click", () => window.print());
  document.getElementById("printSummary").addEventListener("click", () => window.print());

  document.getElementById("copySummary").addEventListener("click", async () => {
    const text = (finalSummaryEl.textContent || "").trim();
    try{
      await navigator.clipboard.writeText(text);
      alert("Copied ‚úÖ");
    }catch(e){
      alert("Copy failed. You can select the text and copy manually.");
    }
  });

  function bindRecalc(ids){
    ids.forEach(id => {
      const el = document.getElementById(id);
      if(!el) return;
      el.addEventListener("input", renderAll);
      el.addEventListener("change", renderAll);
    });
  }

  bindRecalc([
    "adults","children","roomHire","dryHire","security",
    "pCanapes","pAntipasto","pPasta","pMains","pDessert","pSupper","enableSupperPricing",
    "coupleName","weddingDate","venueSpace","email","phone","notes",
    "drinkMode","customDrinkPrice","customDrinkNote",
    "vegMain","fruitPlatter","tables","fruitPerTable"
  ]);

  function bindCourse(course){
    document.querySelectorAll(`input[type="checkbox"][data-course="${course}"]`).forEach(cb => {
      cb.addEventListener("change", () => {
        enforceLimit(course);
        renderAll();
      });
    });
    enforceLimit(course);
  }

  drinkModeEl.addEventListener("change", renderAll);

  addCheckboxList("Canap√©s","list-Canap√©s");
  addCheckboxList("Pasta","list-Pasta");
  addCheckboxList("Mains","list-Mains");
  addCheckboxList("Dessert","list-Dessert");
  addCheckboxList("Supper","list-Supper");
  renderFixedAntipasto();

  ["Canap√©s","Pasta","Mains","Dessert","Supper"].forEach(bindCourse);
  renderAll();
</script>
</body>
</html>