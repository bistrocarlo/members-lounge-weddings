---

## ‚úÖ 4) `app.py` (FULL WORKING CODE)

```python
import streamlit as st
import pandas as pd
from datetime import datetime
from fpdf import FPDF

# ==========================
# PAGE CONFIG + BRAND STYLE
# ==========================
st.set_page_config(
    page_title="Signature Weddings Hub | The Members Lounge",
    page_icon="üíç",
    layout="wide"
)

st.markdown(
    """
    <style>
      .block-container { padding-top: 1.2rem; padding-bottom: 2rem; }
      .ml-title { font-size: 2.2rem; font-weight: 800; color: #C6A75E; margin-bottom: 0.2rem; }
      .ml-sub { font-size: 1.05rem; opacity: 0.85; margin-top: 0; }
      .ml-card { border: 1px solid rgba(198,167,94,0.35); border-radius: 14px; padding: 14px 16px; background: rgba(255,255,255,0.55); }
      .ml-muted { opacity: 0.75; }
      .ml-badge { display:inline-block; padding: 2px 10px; border-radius: 999px; background: rgba(198,167,94,0.12); border: 1px solid rgba(198,167,94,0.35); }
    </style>
    """,
    unsafe_allow_html=True
)

# ==========================
# HELPERS
# ==========================
def aud(n: float) -> str:
    """Format number as AUD with $ symbol."""
    try:
        return f"${n:,.2f}"
    except Exception:
        return "$0.00"

def init_state():
    if "user_name" not in st.session_state:
        st.session_state.user_name = "Carlo"
    if "event_name" not in st.session_state:
        st.session_state.event_name = "Signature Wedding"
    if "event_date" not in st.session_state:
        st.session_state.event_date = datetime.now().date()
    if "guest_count" not in st.session_state:
        st.session_state.guest_count = 120
    if "avg_table_size" not in st.session_state:
        st.session_state.avg_table_size = 10
    if "run_sheet" not in st.session_state:
        st.session_state.run_sheet = pd.DataFrame(
            {
                "Time": ["4:30 PM", "5:00 PM", "6:30 PM"],
                "Item (what happens)": ["Guest Arrival", "Ceremony", "Entr√©es Served"],
                "Owner (who runs it)": ["Venue", "Celebrant", "Kitchen"],
                "Notes": ["Welcome drinks ready", "Microphone check", "Dietaries flagged"],
            }
        )

    # Menu selections (6 each)
    if "menu_choices" not in st.session_state:
        st.session_state.menu_choices = {
            "Canap√©s (choose up to 6)": [
                "Arancini (oven baked)",
                "Polpette al sugo (mini meatballs)",
                "Crostini (ricotta + honey + walnuts)",
                "Bruschetta (tomato + basil)",
                "Calamari (oven style / grilled)",
                "Mini parmigiana bites",
                "Prosciutto + melon",
                "Caprese skewers",
                "Salsiccia bites",
                "Focaccia + dips trio",
                "Stuffed mushrooms",
                "Grilled prawns",
            ],
            "Entr√©es (choose up to 6)": [
                "Antipasto misto platter",
                "Burrata + heirloom tomato",
                "Carpaccio di manzo",
                "Octopus salad (insalata di polpo)",
                "Calabrian chilli prawns (light)",
                "Eggplant involtini",
                "Prosciutto + buffalo mozzarella",
                "Grilled zucchini + mint + feta",
            ],
            "Mains (choose up to 6)": [
                "Lamb shoulder (slow roasted)",
                "Chicken breast (char-grilled)",
                "Barramundi (lemon butter + capers)",
                "Beef scotch fillet (rosemary jus)",
                "Pork belly (crackling, apple salsa)",
                "Veal scaloppine (marsala)",
                "Vegetarian parmigiana",
            ],
            "Desserts (choose up to 6)": [
                "Mini cannoli",
                "Tiramisu cups",
                "Panna cotta",
                "Baklava",
                "Gelato station",
                "Wedding cake served with berries",
                "Affogato bar",
            ],
            "Supper (choose up to 6)": [
                "Gourmet pies",
                "Panini station",
                "Pasta late-night cups",
                "Arrosticini skewers",
                "Mini burgers",
                "Pizza slices",
                "Fruit platters",
            ],
        }

    if "selected_menu" not in st.session_state:
        st.session_state.selected_menu = {k: [] for k in st.session_state.menu_choices.keys()}

init_state()

def tables_required(guests: int, table_size: int) -> int:
    if table_size <= 0:
        return 0
    return int((guests + table_size - 1) // table_size)

def build_budget(
    guests: int,
    room_hire: float,
    dry_hire: float,
    security: float,
    food_pp: float,
    bev_pp: float,
    photo: float,
    dj: float,
    florals: float,
    celebrant: float,
    misc: float,
    upsells: float,
):
    food_total = guests * food_pp
    bev_total = guests * bev_pp
    total = room_hire + dry_hire + security + food_total + bev_total + photo + dj + florals + celebrant + misc + upsells
    per_guest = total / guests if guests else 0
    return {
        "guests": guests,
        "room_hire": room_hire,
        "dry_hire": dry_hire,
        "security": security,
        "food_pp": food_pp,
        "bev_pp": bev_pp,
        "food_total": food_total,
        "bev_total": bev_total,
        "photo": photo,
        "dj": dj,
        "florals": florals,
        "celebrant": celebrant,
        "misc": misc,
        "upsells": upsells,
        "total": total,
        "per_guest": per_guest,
    }

def make_pdf(title: str, lines: list[str], out_path: str):
    pdf = FPDF()
    pdf.add_page()
    pdf.set_auto_page_break(auto=True, margin=15)
    pdf.set_font("Helvetica", size=14)
    pdf.cell(0, 10, title, ln=True)
    pdf.ln(2)
    pdf.set_font("Helvetica", size=11)
    for line in lines:
        pdf.multi_cell(0, 6, line)
    pdf.output(out_path)

# ==========================
# HEADER
# ==========================
left, right = st.columns([0.78, 0.22], vertical_alignment="center")
with left:
    st.markdown("<div class='ml-title'>Signature Weddings Hub</div>", unsafe_allow_html=True)
    st.markdown("<div class='ml-sub'>The Members Lounge ‚Ä¢ Parkville, Melbourne</div>", unsafe_allow_html=True)
with right:
    st.markdown(f"<div class='ml-badge'>Logged in as <b>{st.session_state.user_name}</b></div>", unsafe_allow_html=True)

st.divider()

# ==========================
# SIDEBAR NAV
# ==========================
st.sidebar.header("Navigation")
module = st.sidebar.radio(
    "Go to",
    [
        "Dashboard",
        "Seating",
        "Diary (Run Sheet)",
        "Menu Selection (6 each)",
        "Guestlist Predictor",
        "Budget Calculator",
        "Upsell Engine",
        "Export Center",
        "Admin Settings",
    ],
)

# ==========================
# DASHBOARD
# ==========================
if module == "Dashboard":
    st.subheader("Real-Time Dashboard")

    col1, col2, col3, col4 = st.columns(4)
    col1.metric("Event", st.session_state.event_name)
    col2.metric("Event Date", str(st.session_state.event_date))
    col3.metric("Guests (current)", st.session_state.guest_count)
    col4.metric("Tables (auto)", tables_required(st.session_state.guest_count, st.session_state.avg_table_size))

    st.markdown("<div class='ml-card'>", unsafe_allow_html=True)
    st.write("**Status**: On Track ‚úÖ")
    st.write("**Melbourne Weather**: Placeholder (API can be connected later)")
    st.write("**Notes**: This dashboard updates live as you change guests, seating, and budget.")
    st.markdown("</div>", unsafe_allow_html=True)

    st.caption("Tip: Use the left sidebar like tabs ‚Äî couples can jump between modules instantly on mobile.")

# ==========================
# SEATING
# ==========================
elif module == "Seating":
    st.subheader("Seating Management (Dynamic Scaling)")

    c1, c2, c3 = st.columns(3)
    with c1:
        st.session_state.guest_count = st.number_input("Total Guests", 20, 600, int(st.session_state.guest_count))
    with c2:
        st.session_state.avg_table_size = st.number_input("Seats per Table", 6, 14, int(st.session_state.avg_table_size))
    with c3:
        st.metric("Tables Required", tables_required(st.session_state.guest_count, st.session_state.avg_table_size))

    st.text_area(
        "Floor Plan Notes (VIP, stage, aisle, parents tables, etc.)",
        value="VIP table near stage. Parents at Table 1. Dancefloor clear line of sight.",
        height=120,
    )

# ==========================
# DIARY / RUN SHEET
# ==========================
elif module == "Diary (Run Sheet)":
    st.subheader("Diary (Run Sheet) ‚Äì Item-First Structure")

    st.write("Edit live. Add rows for speeches, cake, first dance, bouquet, supper, send-off, etc.")
    st.session_state.run_sheet = st.data_editor(st.session_state.run_sheet, num_rows="dynamic", use_container_width=True)

    st.info("Upsell prompt idea: before saving final run sheet ‚Üí suggest late-night supper, band, or champagne tower.")

# ==========================
# MENU SELECTIONS (6 each)
# ==========================
elif module == "Menu Selection (6 each)":
    st.subheader("Menu Selection ‚Äì Choose up to 6 in each category")

    st.caption("These are placeholder menu options. You can paste the exact list from reggiocalabriaclub.com.au anytime.")

    for section, options in st.session_state.menu_choices.items():
        st.markdown(f"### {section}")
        selected = st.multiselect(
            f"Select up to 6 for: {section}",
            options=options,
            default=st.session_state.selected_menu.get(section, []),
            max_selections=6,
            key=f"menu_{section}",
        )
        st.session_state.selected_menu[section] = selected

    st.success("Selections saved in-session. For multi-user, connect SQLite/Firebase.")

# ==========================
# GUESTLIST PREDICTOR
# ==========================
elif module == "Guestlist Predictor":
    st.subheader("Guestlist Predictor (AI-like Forecast)")

    invited = st.number_input("Invited Guests", 50, 800, 160)
    response_rate = st.slider("Expected RSVP Rate (%)", 40, 100, 85)
    seasonal_factor = st.selectbox("Seasonal Factor (Melbourne)", ["Standard", "Peak Season (+3%)", "Low Season (-5%)"])

    adj = 0
    if seasonal_factor == "Peak Season (+3%)":
        adj = 3
    elif seasonal_factor == "Low Season (-5%)":
        adj = -5

    predicted = int(invited * ((response_rate + adj) / 100))
    st.metric("Predicted Final Guests", predicted)

    if st.button("Apply Prediction to Seating/Budget"):
        st.session_state.guest_count = predicted
        st.success(f"Applied: guest count is now {predicted}")

# ==========================
# BUDGET
# ==========================
elif module == "Budget Calculator":
    st.subheader("Budget Calculator (AUD $)")

    guests = int(st.session_state.guest_count)

    st.markdown("#### Core Venue Costs")
    c1, c2, c3 = st.columns(3)
    with c1:
        room_hire = st.number_input("Room Hire ($)", 0, 100000, 8000)
    with c2:
        dry_hire = st.number_input("Dry Hire ($)", 0, 100000, 0)
    with c3:
        security = st.number_input("Security ($)", 0, 50000, 1500)

    st.markdown("#### Per Person Packages")
    c4, c5 = st.columns(2)
    with c4:
        food_pp = st.number_input("Food Per Person ($)", 0, 1000, 110)
    with c5:
        bev_pp = st.number_input("Beverage Per Person ($)", 0, 1000, 75)

    st.markdown("#### Expanded Options (Optional Vendors)")
    c6, c7, c8 = st.columns(3)
    with c6:
        photo = st.number_input("Photography ($)", 0, 100000, 0)
        celebrant = st.number_input("Celebrant ($)", 0, 20000, 0)
    with c7:
        dj = st.number_input("DJ / Entertainment ($)", 0, 100000, 0)
        florals = st.number_input("Florals ($)", 0, 150000, 0)
    with c8:
        misc = st.number_input("Misc / Contingency ($)", 0, 100000, 0)

    st.divider()

    # Upsells pass-through (from Upsell module) stored in session, default 0
    upsells = float(st.session_state.get("upsell_total", 0.0))

    budget = build_budget(
        guests=guests,
        room_hire=float(room_hire),
        dry_hire=float(dry_hire),
        security=float(security),
        food_pp=float(food_pp),
        bev_pp=float(bev_pp),
        photo=float(photo),
        dj=float(dj),
        florals=float(florals),
        celebrant=float(celebrant),
        misc=float(misc),
        upsells=float(upsells),
    )

    st.markdown("<div class='ml-card'>", unsafe_allow_html=True)
    colA, colB, colC = st.columns(3)
    colA.metric("Total Budget", aud(budget["total"]))
    colB.metric("Average Spend / Guest", aud(budget["per_guest"]))
    colC.metric("Guests Used", budget["guests"])
    st.markdown("</div>", unsafe_allow_html=True)

    st.caption("Weighted-average is based on adult spend denominator (guest count). Children can be handled later as a separate pricing rule.")

# ==========================
# UPSELL ENGINE
# ==========================
elif module == "Upsell Engine":
    st.subheader("Upsell Engine (AI-like Prompts)")

    upsell_options = {
        "Premium Champagne Tower": 2500,
        "Live Italian Band": 4500,
        "Luxury Floral Upgrade": 6000,
        "Premium Wedding Cake Upgrade": 1800,
        "Signature Late Night Supper": 2200,
        "Extended Spirit Package": 3200,
    }

    total = 0
    selected = []
    for name, price in upsell_options.items():
        if st.checkbox(f"{name} (+{aud(price)})", key=f"upsell_{name}"):
            total += price
            selected.append(name)

    st.session_state.upsell_total = float(total)

    st.metric("Upsell Total", aud(total))

    if total > 0:
        st.success("Experience Level: Platinum Signature ‚úÖ")
        st.write("Selected upgrades:", ", ".join(selected))

# ==========================
# EXPORTS
# ==========================
elif module == "Export Center":
    st.subheader("Export Center")

    st.markdown("### Run Sheet Exports")
    run_csv = st.session_state.run_sheet.to_csv(index=False).encode("utf-8")
    st.download_button("Download Run Sheet (CSV)", run_csv, file_name="run_sheet.csv", mime="text/csv")

    if st.button("Generate Run Sheet PDF"):
        lines = [f"{row['Time']} ‚Äî {row['Item (what happens)']} ‚Äî Owner: {row['Owner (who runs it)']} ‚Äî Notes: {row.get('Notes','')}"
                 for _, row in st.session_state.run_sheet.iterrows()]
        make_pdf("Signature Weddings Run Sheet | The Members Lounge", lines, "run_sheet.pdf")
        with open("run_sheet.pdf", "rb") as f:
            st.download_button("Download Run Sheet (PDF)", f, file_name="run_sheet.pdf", mime="application/pdf")

    st.divider()

    st.markdown("### Menu Selections Export")
    menu_rows = []
    for section, picked in st.session_state.selected_menu.items():
        for item in picked:
            menu_rows.append({"Section": section, "Selection": item})
    menu_df = pd.DataFrame(menu_rows) if menu_rows else pd.DataFrame([{"Section": "None", "Selection": "No items selected yet"}])

    menu_csv = menu_df.to_csv(index=False).encode("utf-8")
    st.download_button("Download Menu Selections (CSV)", menu_csv, file_name="menu_selections.csv", mime="text/csv")

    st.divider()

    st.markdown("### iCal Placeholder")
    st.code(
        "BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Members Lounge//Signature Weddings Hub//EN\nBEGIN:VEVENT\nSUMMARY:Wedding Day\nDTSTART:20260101T170000\nDTEND:20260101T235900\nLOCATION:The Members Lounge, Parkville\nEND:VEVENT\nEND:VCALENDAR",
        language="text",
    )
    st.caption("Replace DTSTART/DTEND with the real event date/time when ready.")

# ==========================
# ADMIN
# ==========================
elif module == "Admin Settings":
    st.subheader("Admin Settings (Simulated Login + Production Notes)")

    st.session_state.user_name = st.text_input("Display Name", value=st.session_state.user_name)
    st.session_state.event_name = st.text_input("Default Event Name", value=st.session_state.event_name)
    st.session_state.event_date = st.date_input("Event Date", value=st.session_state.event_date)

    st.divider()
    st.markdown("### Integrations (Placeholders)")
    st.write("- Weather API (Melbourne): **placeholder**")
    st.write("- Payments (Stripe): **placeholder**")
    st.write("- Database (SQLite/Firebase): **recommended for multi-user**")
    st.write("- VR Tours: embed a 360¬∞ link (YouTube/Kuula/Google)")

    st.warning("Privacy note: Production version should have authentication, role-based permissions, and secure storage.")
